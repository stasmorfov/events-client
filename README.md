# Events client

Это REST API, реализованное на Laravel 12, которое выступает в роли тонкого клиента для внешнего API по продаже билетов. Оно предоставляет набор эндпоинтов для получения информации о мероприятиях и для бронирования мест.

## Системные требования

Перед началом установки убедитесь, что на вашей машине установлены:

-   **PHP 8.4**
-   **Composer** (менеджер зависимостей для PHP)
-   **Git**

## Установка и запуск проекта

### 1. Клонирование репозитория

Склонируйте репозиторий с помощью Git и перейдите в созданную директорию:

```bash
git clone https://github.com/stasmorfov/events-client
cd events-client
```

### 2. Установка зависимостей

Проект использует Composer для управления PHP-пакетами. Выполните следующую команду для их установки:

```bash
composer install
```

### 3. Настройка файла окружения

Создайте рабочий файл конфигурации `.env` на основе предоставленного шаблона:

```bash
cp .env.example .env
```

После этого необходимо сгенерировать уникальный ключ шифрования для вашего приложения:

```bash
php artisan key:generate
```

**Важно:** Откройте созданный `.env` файл и убедитесь, что значение переменной `APP_URL` соответствует адресу вашего локального сервера (по умолчанию `http://localhost:8000`). Настройка для документации API зависит от этой переменной.

### 4. Генерация документации

API проекта документировано с помощью Swagger. Перед первым запуском необходимо сгенерировать файл документации. Выполните команду:

```bash
php artisan l5-swagger:generate
```

### 5. Запуск локального сервера

Теперь проект готов к запуску. Используйте встроенный сервер Laravel Artisan:

```bash
php artisan serve
```

После успешного запуска ваше API будет доступно по адресу, указанному в переменной `APP_URL` (например, `http://localhost:8000`).

## Использование API

### Доступ к документации

Интерактивная документация API, где можно ознакомиться со всеми эндпоинтами и выполнить тестовые запросы, доступна по следующему URL:

[http://localhost:8000/api/documentation](http://localhost:8000/api/documentation)
*(Замените `localhost:8000` на адрес вашего сервера, если он отличается)*

### Основные эндпоинты

-   **Получить список мероприятий:** `GET /api/shows`
-   **Получить детали мероприятия:** `GET /api/shows/{showId}`
-   **Получить схему зала события:** `GET /api/shows/{showId}/events/{eventId}/places`
-   **Забронировать места:** `POST /api/shows/{showId}/events/{eventId}/reserve`
    -   **Тело запроса (JSON):**
        ```json
        {
            "buyer_name": "Иван Иванов",
            "places": [1, 2, 3]
        }
        ```

## Тестирование

Проект содержит автоматические тесты для проверки основной функциональности. Для их запуска из корневой директории проекта выполните команду:

```bash
php artisan test
```


## Архитектура

Для реализации этого проекта выбрал слоистую архитектуру с применением принципа инверсии зависимостей.
Разделил приложение на независимые слои, каждый из которых имеет свою четкую зону ответственности. Это делает код чистым, тестируемым, легко расширяемым и поддерживаемым.

Слои:

1.  **Контроллер:** Принимает входящие HTTP-запросы и возвращает HTTP-ответы. Его задачи — принять запрос, проверить данные и передать команду дальше.

2.  **Координатор:** Он получает команду от контроллера (например, "дай список мероприятий") и решает, кому ее поручить.

3.  **Шлюз:** Знает, как именно общаться с API текущего поставщика: какие у него URL-адреса и какой формат данных он ожидает.

4.  **Контракт:** В нем прописано, какие команды координатор может отдавать ('дай список мероприятий', 'забронируй место'), а любой шлюз обязуется их выполнить.

**Почему архитектура подходит**

*   **Простая замена поставщика:** Если завтра появится новый поставщик билетов с другим API, нам не нужно будет переписывать все приложение. Нужно лишь написать новый шлюз под новое API и в единственном месте кода сказать работать через него. Все остальное продолжит работать как раньше.

*   **Надежное тестирование:** Мы можем проверить работу координатора, подключив к нему тестировочный шлюз, который не делает реальных запросов в интернет. Это делает тесты быстрыми и стабильными.

*   **Порядок и чистота:** Каждый компонент выполняет свою простую задачу, что упрощает понимание и поддержку приложения.

